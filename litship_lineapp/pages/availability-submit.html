<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¨¼åƒå¯èƒ½æ—¥æå‡º - ã‚¹ã‚¿ãƒƒãƒ•å´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #1A3A52 0%, #00A0B0 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header h1 {
            margin-bottom: 10px;
        }
        .alert-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .alert-box.urgent {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        .calendar-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .month-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }
        .calendar-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .calendar-day {
            aspect-ratio: 1;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }
        .calendar-day:hover {
            border-color: #00A0B0;
            transform: scale(1.05);
        }
        .calendar-day.selected {
            background: #00A0B0;
            color: white;
            border-color: #00A0B0;
        }
        .calendar-day.disabled {
            background: #f8f9fa;
            color: #adb5bd;
            cursor: not-allowed;
        }
        .calendar-day.weekend {
            background: #e7f3ff;
        }
        .calendar-day.selected.weekend {
            background: #00A0B0;
        }
        .submit-section {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }
        .btn-primary {
            background: #1A3A52;
            color: white;
        }
        .btn-primary:hover {
            background: #00A0B0;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 160, 176, 0.4);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-back {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            margin-bottom: 20px;
            display: inline-block;
        }
        .status-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .selection-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .selection-summary strong {
            font-size: 18px;
            color: #00A0B0;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="btn btn-back" onclick="location.href='dashboard.html'">â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹</button>

        <div class="header">
            <h1>ğŸ“… ç¨¼åƒå¯èƒ½æ—¥æå‡º</h1>
            <p>æ¥æœˆã®ç¨¼åƒå¯èƒ½ãªæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
        </div>

        <!-- ã‚¢ãƒ©ãƒ¼ãƒˆ -->
        <div id="alertBox" class="alert-box" style="display: none;">
            <strong>âš ï¸ æå‡ºæœŸé™ã¾ã§æ®‹ã‚Š <span id="daysLeft"></span>æ—¥ã§ã™ï¼</strong>
            <p>æ¯æœˆ15æ—¥ã¾ã§ã«æ¥æœˆåˆ†ã®ç¨¼åƒå¯èƒ½æ—¥ã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚</p>
        </div>

        <!-- æå‡ºçŠ¶æ³ -->
        <div id="statusInfo" class="status-info" style="display: none;">
            <strong>âœ… æå‡ºæ¸ˆã¿</strong>
            <p>æå‡ºæ—¥æ™‚: <span id="submittedDate"></span></p>
            <p>é¸æŠæ—¥æ•°: <span id="submittedDays"></span>æ—¥</p>
        </div>

        <!-- é¸æŠçŠ¶æ³ -->
        <div class="selection-summary">
            <strong>é¸æŠä¸­: <span id="selectedCount">0</span>æ—¥</strong>
        </div>

        <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
        <div class="calendar-card">
            <div class="month-selector">
                <button class="btn btn-secondary" onclick="previousMonth()">â† å‰æœˆ</button>
                <h2 id="currentMonth">2025å¹´12æœˆ</h2>
                <button class="btn btn-secondary" onclick="nextMonth()">æ¬¡æœˆ â†’</button>
            </div>

            <div class="calendar-grid" id="calendarGrid"></div>

            <div class="submit-section">
                <button class="btn btn-secondary" onclick="clearSelection()">ã‚¯ãƒªã‚¢</button>
                <button class="btn btn-primary" onclick="submitAvailability()">âœ… æå‡ºã™ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        let currentYear = 2025;
        let currentMonth = 11; // 0-indexed (11 = December)
        let selectedDates = new Set();
        let staffId = "001"; // å®Ÿéš›ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‹ã‚‰å–å¾—

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰æå‡ºæ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadSubmittedData() {
            const key = `availability_${staffId}_${currentYear}_${currentMonth}`;
            const data = localStorage.getItem(key);
            if (data) {
                const parsed = JSON.parse(data);
                selectedDates = new Set(parsed.dates);
                document.getElementById('statusInfo').style.display = 'block';
                document.getElementById('submittedDate').textContent = parsed.submittedAt;
                document.getElementById('submittedDays').textContent = parsed.dates.length;
            } else {
                document.getElementById('statusInfo').style.display = 'none';
            }
            updateSelectedCount();
        }

        // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤ºåˆ¤å®š
        function checkDeadline() {
            const today = new Date();
            const currentDay = today.getDate();
            const deadline = 15;
            
            if (currentDay <= deadline) {
                const daysLeft = deadline - currentDay;
                document.getElementById('alertBox').style.display = 'block';
                document.getElementById('daysLeft').textContent = daysLeft;
                
                if (daysLeft <= 3) {
                    document.getElementById('alertBox').classList.add('urgent');
                }
            } else {
                document.getElementById('alertBox').style.display = 'none';
            }
        }

        // é¸æŠæ•°æ›´æ–°
        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedDates.size;
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            // ãƒ˜ãƒƒãƒ€ãƒ¼
            const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            days.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                grid.appendChild(header);
            });

            // æœˆã®æƒ…å ±
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            // ç©ºç™½ã‚»ãƒ«
            for (let i = 0; i < firstDay; i++) {
                grid.appendChild(document.createElement('div'));
            }

            // æ—¥ä»˜ã‚»ãƒ«
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = 'calendar-day';
                cell.textContent = day;

                const date = new Date(currentYear, currentMonth, day);
                const dayOfWeek = date.getDay();

                // é€±æœ«ã‚¹ã‚¿ã‚¤ãƒ«
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    cell.classList.add('weekend');
                }

                // é¸æŠæ¸ˆã¿ã‚¹ã‚¿ã‚¤ãƒ«
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                if (selectedDates.has(dateStr)) {
                    cell.classList.add('selected');
                }

                // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                cell.addEventListener('click', () => toggleDate(dateStr, cell));

                grid.appendChild(cell);
            }

            document.getElementById('currentMonth').textContent = 
                `${currentYear}å¹´${currentMonth + 1}æœˆ`;
        }

        // æ—¥ä»˜é¸æŠãƒˆã‚°ãƒ«
        function toggleDate(dateStr, element) {
            if (selectedDates.has(dateStr)) {
                selectedDates.delete(dateStr);
                element.classList.remove('selected');
            } else {
                selectedDates.add(dateStr);
                element.classList.add('selected');
            }
            updateSelectedCount();
        }

        // æå‡º
        function submitAvailability() {
            if (selectedDates.size === 0) {
                alert('ç¨¼åƒå¯èƒ½æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const data = {
                staffId: staffId,
                staffName: 'å‘åŸã‚ã‹ã‚Š', // å®Ÿéš›ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‹ã‚‰å–å¾—
                year: currentYear,
                month: currentMonth + 1,
                dates: Array.from(selectedDates),
                submittedAt: new Date().toLocaleString('ja-JP')
            };

            const key = `availability_${staffId}_${currentYear}_${currentMonth}`;
            localStorage.setItem(key, JSON.stringify(data));

            // ç®¡ç†å´ç”¨ãƒ‡ãƒ¼ã‚¿ã‚‚ä¿å­˜
            let allSubmissions = JSON.parse(localStorage.getItem('all_availability_submissions') || '[]');
            
            // æ—¢å­˜ã®åŒã˜ã‚¹ã‚¿ãƒƒãƒ•ãƒ»åŒã˜æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
            allSubmissions = allSubmissions.filter(sub => 
                !(sub.staffId === staffId && sub.year === currentYear && sub.month === currentMonth + 1)
            );
            
            allSubmissions.push(data);
            localStorage.setItem('all_availability_submissions', JSON.stringify(allSubmissions));

            alert('âœ… ç¨¼åƒå¯èƒ½æ—¥ã‚’æå‡ºã—ã¾ã—ãŸï¼');
            location.reload();
        }

        // ã‚¯ãƒªã‚¢
        function clearSelection() {
            if (confirm('é¸æŠã—ãŸæ—¥ä»˜ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                selectedDates.clear();
                renderCalendar();
                updateSelectedCount();
            }
        }

        // æœˆç§»å‹•
        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            selectedDates.clear();
            loadSubmittedData();
            renderCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            selectedDates.clear();
            loadSubmittedData();
            renderCalendar();
        }

        // åˆæœŸåŒ–
        checkDeadline();
        loadSubmittedData();
        renderCalendar();
    </script>
</body>
</html>

