<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>実績管理・スキルシート出力</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/dashboard-extended.css">
    <link rel="stylesheet" href="../assets/css/performance.css">
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <header class="header">
            <h1>📝 実績管理・スキルシート</h1>
            <div class="header-actions">
                <button class="btn-secondary" onclick="showSection('report')">📝 実績報告</button>
                <button class="btn-secondary" onclick="showSection('history')">📊 実績履歴</button>
                <button class="btn-secondary" onclick="showSection('skillsheet')">📄 スキルシート</button>
                <button class="btn-secondary" onclick="location.href='dashboard.html'">🏠 戻る</button>
            </div>
        </header>

        <!-- 実績報告セクション -->
        <div id="section-report" class="section active">
            <section class="card">
                <h2>📝 実績報告を入力</h2>
                
                <form id="performanceForm" class="performance-form">
                    <!-- スタッフ選択 -->
                    <div class="form-group">
                        <label>スタッフ *</label>
                        <select id="staffSelect" required>
                            <option value="">選択してください</option>
                        </select>
                    </div>

                    <!-- 案件選択 -->
                    <div class="form-group">
                        <label>案件 *</label>
                        <select id="projectSelect" required>
                            <option value="">選択してください</option>
                        </select>
                    </div>

                    <!-- 実施日 -->
                    <div class="form-group">
                        <label>実施日 *</label>
                        <input type="date" id="workDate" required>
                    </div>

                    <!-- 成果入力 -->
                    <div class="performance-grid">
                        <div class="form-group">
                            <label>MNP獲得数</label>
                            <input type="number" id="mnpCount" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>光契約数</label>
                            <input type="number" id="hikariCount" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>カード契約数</label>
                            <input type="number" id="cardCount" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>端末販売数</label>
                            <input type="number" id="deviceCount" min="0" value="0">
                        </div>
                    </div>

                    <!-- 評価 -->
                    <div class="form-group">
                        <label>総合評価 *</label>
                        <div class="rating-selector">
                            <button type="button" class="rating-btn" data-rating="5">⭐⭐⭐⭐⭐</button>
                            <button type="button" class="rating-btn" data-rating="4">⭐⭐⭐⭐</button>
                            <button type="button" class="rating-btn" data-rating="3">⭐⭐⭐</button>
                            <button type="button" class="rating-btn" data-rating="2">⭐⭐</button>
                            <button type="button" class="rating-btn" data-rating="1">⭐</button>
                        </div>
                        <input type="hidden" id="rating" required>
                    </div>

                    <!-- コメント -->
                    <div class="form-group">
                        <label>コメント・特記事項</label>
                        <textarea id="comment" rows="4" placeholder="良かった点、改善点など..."></textarea>
                    </div>

                    <!-- 送信ボタン -->
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">📝 実績を登録</button>
                        <button type="reset" class="btn-secondary">クリア</button>
                    </div>
                </form>
            </section>

            <!-- クイック登録 -->
            <section class="card">
                <h2>⚡ クイック登録</h2>
                <p style="color:#718096;margin-bottom:20px;">過去の案件から素早く実績を登録</p>
                <div id="quickRegister"></div>
            </section>
        </div>

        <!-- 実績履歴セクション -->
        <div id="section-history" class="section">
            <section class="card">
                <h2>📊 実績履歴</h2>
                
                <!-- フィルター -->
                <div class="filter-section">
                    <select id="historyStaffFilter" class="filter-select">
                        <option value="">全スタッフ</option>
                    </select>
                    <select id="historyPeriodFilter" class="filter-select">
                        <option value="all">全期間</option>
                        <option value="today">今日</option>
                        <option value="week">今週</option>
                        <option value="month">今月</option>
                    </select>
                    <button class="btn-primary" onclick="applyHistoryFilters()">絞り込み</button>
                </div>

                <!-- 実績一覧 -->
                <div id="performanceList"></div>
            </section>

            <!-- 統計サマリー -->
            <section class="card">
                <h2>📈 統計サマリー</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalMNP">0</div>
                        <div class="stat-label">MNP獲得</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalHikari">0</div>
                        <div class="stat-label">光契約</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalCard">0</div>
                        <div class="stat-label">カード</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgRating">0.0</div>
                        <div class="stat-label">平均評価</div>
                    </div>
                </div>
            </section>
        </div>

        <!-- スキルシートセクション -->
        <div id="section-skillsheet" class="section">
            <section class="card">
                <h2>📄 スキルシート出力</h2>
                
                <!-- スタッフ選択 -->
                <div class="skillsheet-selector">
                    <select id="skillsheetStaffSelect" class="filter-select">
                        <option value="">スタッフを選択</option>
                    </select>
                    <button class="btn-primary" onclick="generateSkillSheet()">プレビュー</button>
                </div>

                <!-- スキルシートプレビュー -->
                <div id="skillsheetPreview"></div>

                <!-- 出力ボタン -->
                <div class="export-actions" id="exportActions" style="display:none;">
                    <button class="btn-export" onclick="exportSkillSheetPDF()">
                        📄 PDF出力
                    </button>
                    <button class="btn-export" onclick="exportSkillSheetExcel()">
                        📊 Excel出力
                    </button>
                    <button class="btn-export" onclick="exportSkillSheetImage()">
                        🖼️ 画像出力
                    </button>
                    <button class="btn-export" onclick="copySkillSheetText()">
                        📋 テキストコピー
                    </button>
                </div>
            </section>

            <!-- 一括出力 -->
            <section class="card">
                <h2>📦 一括出力</h2>
                <p style="color:#718096;margin-bottom:20px;">全スタッフのスキルシートをまとめて出力</p>
                <div class="bulk-export-actions">
                    <button class="btn-secondary" onclick="bulkExportPDF()">
                        📄 全員のPDFを出力
                    </button>
                    <button class="btn-secondary" onclick="bulkExportExcel()">
                        📊 全員のExcelを出力
                    </button>
                </div>
            </section>
        </div>
    </div>

    <!-- モーダル：成功 -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSuccessModal()">&times;</span>
            <h2 style="text-align:center;">✅ 登録完了</h2>
            <p id="successMessage" style="text-align:center;margin-top:20px;"></p>
            <div style="text-align:center;margin-top:30px;">
                <button class="btn-primary" onclick="closeSuccessModal()">OK</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="../assets/data/data-100.js"></script>
    <script src="../assets/js/performance.js"></script>
</body>
</html>

