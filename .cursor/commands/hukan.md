# 俯瞰チェック・シングルソース化コマンド

## 🎯 このコマンドの目的
ビジネスドキュメントのフォルダを全体俯瞰して、シニアレベルなら「きれいにしておいて」と言われてやる作業を、対話しながら段階的に整理・改善するコマンド

**シングルソース原則**: 1つの情報は1つの場所にしか存在しない。重複を排除し、メインソースに統合する。

## 💡 設計思想
- **属人化の解決**: 経験に依存した暗黙知を明文化し、ジュニアでも辿れる思考プロセスを提供
- **対話による段階的改善**: 一気に進めず、変更内容を人間が理解できるよう段階的に確認
- **俯瞰作業の体系化**: 相互リンク漏れ、重複削除、内部構造のドキュメント、フォルダ構成など、俯瞰するときの共通作業を体系化
- **シングルソース原則**: 同じテーマの情報は1箇所に集約し、重複を排除
- **自己進化**: 対話から学び、ルール自体も進化する
- **ビジネスドキュメント特化**: 要件定義書、業務フロー、画面設計書など、ビジネスドキュメントの品質向上に特化

---

## 🔄 シングルソース化チェック

### 目的
複数のフォルダに散らばった同じテーマのファイルを、1つのメインソースに統合し、重複を排除する

### チェック項目

| チェック項目 | 重要度 | 説明 | 確認方法 |
|-------------|--------|------|----------|
| 重複テーマ検出 | 🔴 高 | 同じテーマを扱うファイルが複数フォルダに存在するか | ファイル名・内容の類似性分析 |
| メインソース特定 | 🔴 高 | 統合先のメインソースが明確か | ユーザー指定または更新頻度・詳細度で判断 |
| 統合可能性判定 | 🟡 中 | ファイルを統合できるか | 内容の重複度・関連性を分析 |
| 統合後のリンク更新 | 🔴 高 | 統合後の参照リンクが正しいか | 他のファイルからの参照を確認 |

### 統合パターン

| パターン | 適用条件 | 統合方法 | 例 |
|---------|---------|---------|-----|
| **詳細統合** | 簡潔版と詳細版が存在 | 詳細版をメインに統合、簡潔版を削除 | `README.md`（簡潔） + `詳細設計.md` → `README.md`（詳細統合版） |
| **セクション統合** | 関連する複数ファイル | 1ファイルのセクションとして統合 | `美容業界方針.md` + `美容業界メモ.md` → `08-業界CDO.md`のセクション |
| **参照統合** | プレースホルダーと実在ファイル | プレースホルダーを削除、実在ファイルを参照 | `判断基準ガイドライン.md`（未作成） → `判断フレームワーク.md`を参照 |
| **移動統合** | 提出用ファイルなど | メインソース配下に移動 | `提出用-AI部方針.md` → `yuki_os/戦略2026/04-AI部/`に移動 |

### 実行フロー

1. **重複検出**: 指定フォルダ間で同じテーマのファイルを検出
2. **メインソース決定**: ユーザー指定または自動判定
3. **統合案提示**: どのファイルをどう統合するか提案
4. **承認取得**: ユーザーの承認を得る
5. **統合実行**: ファイル統合・移動・削除
6. **リンク更新**: 参照リンクを更新
7. **空フォルダ削除**: 統合後の空フォルダを削除

### 保護されるファイル

- **思考メモ**: `思考メモ/`配下のファイルはデフォルトで保護（明示的に指定可能）
- **バックアップファイル**: `.bak`, `.backup`などは自動除外
- **一時ファイル**: `.tmp`, `.temp`などは自動除外

---

## 🚨 矛盾チェック（ファイル作成・更新前に必ず実行）

### AIが依頼を受けたとき、以下をチェックする

**ファイル作成・更新の前に、以下の矛盾がないか確認し、あれば指摘する**：

#### 1. パールグローイングとの整合性

```
確認事項:
□ 現在のSTEPを飛ばしていないか？
□ 委譲体制確立（Phase 1）の前に新プロダクトを始めようとしていないか？
□ 依存関係を無視していないか？

矛盾例:
× 「委譲体制ができる前に新プロダクトを作りたい」
× 「STEP 3の前にSTEP 6をやりたい」
```

#### 2. やらないことリストとの整合性

```
確認事項:
□ やらないことリストに載っている項目を始めようとしていないか？
□ 「2026年にやらないこと」に該当していないか？

矛盾例:
× 「シンガポール法人を今すぐ作りたい」（→ タイ案件待ち）
× 「ふるさと納税プロダクトを今年始めたい」（→ 2027年以降）
× 「委譲前に新プロダクト」（→ Phase 1が先）
```

#### 3. ホロスコープ・バイオリズムとの整合性

```
確認事項:
□ 孤独タイムを確保できる設計か？
□ 感情だけで決めていないか？（風0%の補完）
□ 自分を安売りしていないか？（MC獅子座）

矛盾例:
× 「毎日予定をぎっしり入れたい」（→ 孤独タイム必要）
× 「安くてもいいから案件を取りたい」（→ 安売り禁止）
```

#### 4. 時間配分との整合性

```
確認事項:
□ 技術・オペレーション（0%）に時間を使おうとしていないか？
□ 本域40%、思想30%の配分を崩していないか？

矛盾例:
× 「自分でコードを書きたい」（→ 水野さんに任せる）
× 「進捗管理を自分でやりたい」（→ PMに任せる）
```

### 矛盾を発見した場合のフォーマット

```
## ⚠️ 矛盾チェック警告

**依頼内容**: [和島の依頼]
**矛盾箇所**: [どのルール・ファイルと矛盾しているか]
**参照ファイル**: [該当ファイルのパス]

**矛盾の内容**:
[具体的にどう矛盾しているか]

**推奨対応**:
[代替案や正しい順序]

このまま進めますか？それとも修正しますか？
```

### 矛盾チェックの優先順位

1. **パールグローイング**（実行順序）が最優先
2. **やらないことリスト**（境界線）
3. **ホロスコープ・バイオリズム**（制約条件）
4. **時間配分**（リソース）

---

## 🧬 自己進化ルール

### AIが対話から学ぶべきこと

和島との対話で以下のパターンを発見したら、**関連ファイルの更新を提案する**：

1. **新しい概念・フレームワークが出てきた**
   - 既存ファイルに追記するか、新規ファイルを作成
   - 例：「行動喚起と認知不協和の関係」→ 得意能力.md に追記

2. **既存の概念に新しい解釈が加わった**
   - 該当ファイルを更新
   - 例：「ギャル力は論理的説明より行動喚起」→ 得意能力.md を拡張

3. **フォルダ間の依存関係が明確になった**
   - PlantUMLファイルを更新
   - 例：「ツールスタックは学習対象」→ 全体構造.puml に接続追加

4. **このルール自体の改善点が見つかった**
   - hukan.md を更新
   - 例：「Mermaidは禁止」→ ルールに追記

### 更新提案のフォーマット

```
## 📝 更新提案

**発見**: [対話で発見したこと]
**対象ファイル**: [更新すべきファイル]
**更新内容**: [追記/修正の概要]

更新してよいですか？
```

### 自動更新の条件

以下の場合、確認なしで更新してよい：
- PlantUMLの接続追加（既存構造の補完）
- 誤字脱字の修正
- 相互リンクの追加

以下の場合、必ず確認を取る：
- 新しい概念の追加
- 既存概念の解釈変更
- ファイルの削除・統合

---

## 📊 俯瞰チェック項目

### 1. 基本構造チェック

| チェック項目 | 重要度 | 説明 | 確認方法 |
|-------------|--------|------|----------|
| README.md存在確認 | 🔴 高 | プロジェクト概要が明記されているか | 各フォルダにREADME.mdが存在し、内容が適切か |
| ディレクトリ構造 | 🟡 中 | 論理的で分かりやすい構造か | フォルダ名が業務フローに沿っているか |
| ファイル命名規則 | 🟡 中 | 統一された命名規則か | 大文字小文字、ハイフン vs アンダースコアの統一 |
| 不要ファイル除外 | 🟢 低 | 一時ファイル等が除外されているか | .DS_Store、Thumbs.db、*.tmp等の削除 |
| 英語/日本語フォルダの重複 | 🔴 高 | 英語版と日本語版が混在していないか | 日本語を正として英語を削除 |

### 2. リンク整合性チェック

| チェック項目 | 重要度 | 説明 | 確認方法 |
|-------------|--------|------|----------|
| 内部リンク整合性 | 🔴 高 | 内部リンクが実際のファイルと一致しているか | リンク先ファイルの存在確認 |
| 外部リンク有効性 | 🟡 中 | 外部リンクが有効か | リンクのアクセス可能性確認 |
| 相互参照リンク | 🟡 中 | 相互参照リンクが適切に設定されているか | 双方向リンクの整合性確認 |
| 画像・アセットパス | 🟡 中 | 画像・アセットファイルのパスが正しいか | 画像ファイルの存在確認 |
| 重複リンク検出 | 🟢 低 | 重複リンクがないか | 同一リンクの重複チェック |

### 3. ビジネスドキュメント品質チェック

| チェック項目 | 重要度 | 説明 | 確認方法 |
|-------------|--------|------|----------|
| ファイル目的明記 | 🔴 高 | 各ファイルの目的が明確に記載されているか | ファイル冒頭に目的・概要が記載されているか |
| 使用方法・手順 | 🔴 高 | 使用方法・手順が分かりやすく記載されているか | ステップバイステップの手順が明記されているか |
| 前提条件明記 | 🟡 中 | 前提知識・必要な環境が明記されているか | 必要なスキル、ツール、権限が明記されているか |
| トラブルシューティング | 🟡 中 | トラブルシューティング情報が含まれているか | よくある問題と解決方法が記載されているか |
| ビジネス用語統一 | 🟡 中 | ビジネス用語の統一性が保たれているか | 用語集との整合性確認 |
| 数値・日付整合性 | 🟡 中 | 数値・日付の整合性が保たれているか | 各ドキュメント間の数値・日付の一致確認 |

### 4. ドキュメント構造チェック

| チェック項目 | 重要度 | 説明 | 確認方法 |
|-------------|--------|------|----------|
| 章立て適切性 | 🔴 高 | 要件定義書の章立てが適切か | 論理的な構成になっているか |
| 業務フロー論理性 | 🔴 高 | 業務フローの流れが論理的か | 業務プロセスの順序が適切か |
| 画面遷移完全性 | 🟡 中 | 画面遷移図が完全か | 全画面の遷移が網羅されているか |
| ステークホルダー資料 | 🟡 中 | ステークホルダー別の資料が揃っているか | クライアント、開発、運用向け資料の存在確認 |
| 重複ファイル検出 | 🔴 高 | 重複ファイルがないか | 同一内容ファイルの検出（シングルソース化チェックと連携） |
| 古いバックアップ | 🟢 低 | 古いバックアップファイルがないか | 不要なバックアップファイルの検出 |
| Mermaidコードブロック | 🟡 中 | Mermaidが残っていないか | PlantUMLに変換して削除 |

---

## 🔍 対話による段階的チェック

### チェックの進め方
1. **問題の検出**: 各項目を順番にチェック
2. **問題の説明**: 発見した問題を具体的に説明
3. **改善案の提示**: 解決方法を提案
4. **承認の取得**: ユーザーの承認を得る
5. **実行**: 承認された改善を実行
6. **結果の確認**: 変更内容を確認

### 検出される問題の種類

| 問題カテゴリ | 具体例 | 影響度 | 対応優先度 |
|-------------|--------|--------|------------|
| **構造的問題** | 存在しないファイルへの参照 | 🔴 高 | 即座に対応 |
| | 重複したリンク | 🟡 中 | 計画的な対応 |
| | 不適切なディレクトリ構造 | 🟡 中 | 計画的な対応 |
| | 命名規則の不統一 | 🟢 低 | 時間のある時に対応 |
| | 重複ファイル（シングルソース違反） | 🔴 高 | 即座に対応 |
| **コンテンツの問題** | 目的が不明確なファイル | 🔴 高 | 即座に対応 |
| | 使用方法が記載されていない | 🔴 高 | 即座に対応 |
| | 前提条件が不明 | 🟡 中 | 計画的な対応 |
| | トラブルシューティング情報の不足 | 🟡 中 | 計画的な対応 |
| **ビジネス品質の問題** | ビジネス用語の不統一 | 🟡 中 | 計画的な対応 |
| | 数値・日付の不整合 | 🔴 高 | 即座に対応 |
| | 業務フローの論理性不足 | 🔴 高 | 即座に対応 |
| | ステークホルダー資料の不足 | 🟡 中 | 計画的な対応 |
| **矛盾の問題** | パールグローイングとの矛盾 | 🔴 高 | 即座に対応 |
| | やらないことリストとの矛盾 | 🔴 高 | 即座に対応 |

### 問題の優先度分類

| 優先度 | 色分け | 説明 | 対応方針 |
|--------|--------|------|----------|
| **緊急** | 🔴 | プロジェクト進行に支障をきたす問題 | 即座に対応、作業を停止して修正 |
| **重要** | 🟡 | 使いやすさや品質に大きく影響する問題 | 計画的な対応、次のスプリントで修正 |
| **改善** | 🟢 | 品質向上のための問題 | 時間のある時に対応、継続的改善 |

---

## 🔄 統合ルール

### 新しい情報を追加するとき

1. まずyuki_osの既存ファイルを確認
2. 既存ファイルに追記できるなら追記
3. 新規ファイルが必要なら、フォルダ構成に従って配置

### 対話から学んだことの反映先

| 発見内容 | 反映先 |
|---------|--------|
| 新しい思想・価値観 | 01-思想/ |
| 判断基準・得意能力の拡張 | 02-判断/ |
| 行動習慣・伝え方の改善 | 03-行動/ |
| 事業・営業の知見 | 04-事業/ |
| 技術・ツールの発見 | 05-技術/ → 戦略2026/03-学習技術.md |
| 組織・委譲の原則 | 06-組織/ |
| 年間戦略の進捗 | 戦略2026/ |
| フォルダ間の関係 | PlantUMLファイル |

### yuki_os以外に置くもの

| カテゴリ | 配置先 |
|---------|--------|
| プロジェクト固有のメモ | `マインド/思考メモ/` |
| テンプレート | `マインド/SHARED/templates/` |
| 営業資料・詳細 | `セールス/` |
| クライアント情報 | 各プロジェクトフォルダ |
| 使い捨てタスク | `タスク_YYYY-MM-DD.md`（完了後削除） |

---

## 📊 図表・可視化のルール

### PlantUMLファイルの作成

**原則**: 依存関係、時系列、フローを可視化する場合は **PlantUML** を使用する。

#### 作成すべきケース

1. **依存関係の可視化**
   - パールグローイング（制約条件に基づく順序）
   - タスク間の依存関係
   - フォルダ間・ファイル間の関係

2. **時系列の把握**
   - プロジェクトのロードマップ
   - Phase別の進行状況

3. **フローの整理**
   - 判断プロセス
   - 思想→判断→行動の流れ

#### ファイル命名規則

```
[元のファイル名]-[目的].puml

例:
- yuki_os-全体構造.puml
- yuki_os-戦略2026との関係.puml
- 02-既存コンサル-依存関係.puml
```

#### 色の使い分け（推奨）

| 色 | 用途 | コード |
|---|------|--------|
| #FFE4E1 | 01-思想 | MistyRose |
| #E6E6FA | 02-判断 | Lavender |
| #E0FFE0 | 03-行動 | Honeydew |
| #FFF8DC | 04-事業 | Cornsilk |
| #E0FFFF | 05-技術 | LightCyan |
| #F0E68C | 06-組織 | Khaki |
| #Gold | 最終ゴール | Gold |
| #LightCoral | 最重要・ボトルネック | LightCoral |

---

## 🛠️ 改善提案システム

### 自動改善提案の仕組み
1. **問題の自動検出** → **改善案の自動生成** → **優先度付け** → **実行計画の提示**

### 改善提案のカテゴリ

| 改善カテゴリ | 具体的な改善内容 | 実行難易度 | 効果 |
|-------------|------------------|------------|------|
| **構造的改善** | ディレクトリ構造の最適化 | 🟡 中 | ナビゲーション向上 |
| | ファイル命名規則の統一 | 🟢 低 | 一貫性向上 |
| | 不要ファイルの削除提案 | 🟢 低 | 整理整頓 |
| | シングルソース化（重複統合） | 🔴 高 | 情報の一元化 |
| **コンテンツ改善** | ドキュメントの充実化 | 🟡 中 | 理解しやすさ向上 |
| | 使用例の追加 | 🟡 中 | 実用性向上 |
| | トラブルシューティングの強化 | 🟡 中 | 運用性向上 |
| **ビジネス品質改善** | ビジネス用語の統一 | 🟡 中 | コミュニケーション向上 |
| | 数値・日付の整合性確保 | 🔴 高 | 信頼性向上 |
| | 業務フローの論理化 | 🔴 高 | 効率性向上 |
| | ステークホルダー資料の充実 | 🟡 中 | 合意形成向上 |

### 改善の実行方法
1. **自動修正可能な項目**: リンクパス修正、重複削除、Mermaid→PlantUML変換等
2. **半自動修正項目**: テンプレート生成、構造整理、シングルソース統合等
3. **手動修正項目**: コンテンツ作成、設計変更等

---

## 📋 実行可能なアクション

### 自動実行可能なアクション

| アクション | 実行内容 | 対象ファイル | 実行時間 |
|-----------|----------|-------------|----------|
| リンクパス修正 | 存在しないリンクの自動修正 | 全Markdownファイル | 数秒 |
| 重複リンク削除 | 同一リンクの重複を自動削除 | 全Markdownファイル | 数秒 |
| 不要ファイル削除 | 一時ファイル等の自動削除 | .DS_Store、*.tmp等 | 数秒 |
| ディレクトリ整理 | 論理的な構造への自動整理 | フォルダ構造 | 数分 |
| Mermaid→PlantUML変換 | MermaidコードブロックをPlantUMLに変換 | Markdownファイル | 数分 |

### 半自動実行可能なアクション

| アクション | 実行内容 | 生成物 | 実行時間 |
|-----------|----------|--------|----------|
| README.md生成 | 各フォルダのREADME.md自動作成 | フォルダ別README | 数分 |
| テンプレート生成 | プロジェクトタイプ別テンプレート | 各種テンプレート | 数分 |
| 構造提案 | 最適なディレクトリ構造の提案 | 構造図・説明 | 数分 |
| 命名規則統一 | ファイル命名規則の統一提案 | リネーム提案 | 数分 |
| シングルソース統合 | 重複ファイルの統合・削除 | 統合後のファイル | 数分〜数十分 |

### 手動実行が必要なアクション

| アクション | 実行内容 | 必要スキル | 推定時間 |
|-----------|----------|------------|----------|
| コンテンツ詳細化 | ドキュメント内容の充実化 | ビジネス理解 | 数時間 |
| 使用例作成 | 具体的な使用例の作成 | 実務経験 | 数時間 |
| トラブルシューティング | 問題解決情報の追加 | 運用経験 | 数時間 |
| プロジェクト固有設定 | プロジェクト特有の設定 | ドメイン知識 | 数時間 |

---

## 🎯 俯瞰チェックの実行方法

### 基本的な実行手順
1. **対象フォルダの指定**: 俯瞰したいフォルダを指定
2. **対話によるチェック**: `/hukan` コマンドを実行
3. **段階的な確認**: 各問題について説明し、承認を得る
4. **改善の実行**: 承認された修正を実行
5. **結果の記録**: 改善内容を記録

### 実行タイミング

| 実行タイミング | 頻度 | 目的 | チェック項目 | 所要時間 |
|---------------|------|------|-------------|----------|
| **定期的チェック** | 週1回 | プロジェクト品質維持 | 全項目 | 30分 |
| **プロジェクト開始前** | 1回 | 初期構造検証 | 構造・テンプレート | 1時間 |
| **新規ファイル追加時** | 随時 | 整合性確認 | リンク・構造 | 10分 |
| **リリース前** | 1回 | 最終品質チェック | 全項目（重点的） | 2時間 |
| **クライアント向け資料作成時** | 随時 | プレゼン品質向上 | ビジネス品質 | 1時間 |
| **ステークホルダー会議前** | 随時 | 合意形成支援 | ビジネス品質 | 30分 |
| **シングルソース化** | 月1回 | 重複排除・統合 | 重複検出・統合 | 1-2時間 |

---

## 💡 俯瞰チェックの活用方法

### 役割別活用方法

| 役割 | 活用方法 | 期待効果 | 推奨頻度 |
|------|----------|----------|----------|
| **シニア開発者** | 暗黙知の明文化・品質基準統一 | 属人化の解消・効率化 | 週1回 |
| **ジュニア開発者** | 学習ツール・品質意識向上 | スキル習得・自立性向上 | 週2回 |
| **プロジェクトマネージャー** | 進捗管理・品質確認 | プロジェクト成功・リスク軽減 | 週1回 |
| **クライアント担当** | 資料品質向上・合意形成 | 信頼関係向上・効率的な合意 | 随時 |
| **ビジネスアナリスト** | 要件整理・業務フロー確認 | 要件の網羅性・論理性向上 | 週1回 |

### チーム全体での活用効果

| 効果カテゴリ | 具体的な効果 | 測定指標 |
|-------------|-------------|----------|
| **品質向上** | ドキュメントの一貫性・完全性向上 | エラー率の減少 |
| **効率化** | 情報検索時間の短縮・作業効率向上 | 作業時間の短縮 |
| **知識共有** | 属人化の解消・チーム全体のスキル向上 | ナレッジベースの充実 |
| **リスク軽減** | 見落としの防止・品質問題の早期発見 | 問題発生率の減少 |
| **シングルソース化** | 重複排除・情報の一元化 | 重複ファイル数の減少 |

---

## ⛔ やってはいけないこと

1. **コピペで複製**: 同じ内容を複数箇所に書く
2. **英語/日本語の混在**: フォルダ名は日本語で統一
3. **重複の放置**: 発見したら即座に統合・削除
4. **Mermaidの使用**: 図表はPlantUMLで作成
5. **依存関係の無視**: 上流を変えたら下流も確認
6. **矛盾の無視**: パールグローイングややらないことリストとの矛盾を放置

---

## ✅ 定期チェック（月次）

- [ ] 英語フォルダが残っていないか
- [ ] 同じ内容が複数ファイルに書かれていないか
- [ ] PlantUMLファイルが最新の依存関係を反映しているか
- [ ] yuki_os_for_chatgpt.md が最新か
- [ ] 対話で発見した内容が適切に反映されているか
- [ ] 重複ファイルが統合されているか
- [ ] Mermaidコードブロックが残っていないか

---

## 🚀 次のアクション

### 即座に実行可能

| アクション | 実行内容 | 所要時間 | 期待効果 |
|-----------|----------|----------|----------|
| **対象フォルダ指定** | 俯瞰したいフォルダを指定 | 1分 | 作業範囲の明確化 |
| **初回チェック実行** | `/hukan` コマンドで現在のプロジェクトをチェック | 30分 | 現状把握・問題発見 |
| **段階的改善** | 各問題について対話しながら改善 | 1-2時間 | 品質向上・学習効果 |
| **シングルソース化** | 重複ファイルの統合 | 1-2時間 | 情報の一元化 |

---

> **「1つの情報は1つの場所にしか存在しない」**
> **「依存関係と連続性を大切にする」**
> **「対話から学び、ルール自体も進化する」**
> **「きれいにしておいて」を体系化する**

---

**最終更新**: 2025-01-13
**作成者**: AI駆動開発チーム
**目的**: 属人化した俯瞰作業を体系化し、シングルソース原則を実現
**対象**: あらゆるプロジェクトの俯瞰チェックと品質改善
